#!/usr/bin/env bash
# =============================================================================
# dev — tmuxinator replacement (zero dependencies)
#
# Usage:
#   dev                     # start/attach "dev" session in cwd
#   dev myproject           # start/attach "myproject" session
#   dev myproject ~/code/mp # start in specific directory
#
# Layout:
#   Window 1 "editor":   nvim (fullscreen)
#   Window 2 "terminal": lazygit (left) | shell (right)
#   Window 3 "claude":   Claude Code
#
# Managed by chezmoi — edit via: chezmoi edit ~/bin/dev
# =============================================================================

SESSION="${1:-dev}"
PROJECT_DIR="${2:-$(pwd)}"

# If session exists, just attach
if tmux has-session -t "$SESSION" 2>/dev/null; then
    exec tmux attach -t "$SESSION"
fi

# Create new session with editor window
tmux new-session -d -s "$SESSION" -c "$PROJECT_DIR" -n "editor"
tmux send-keys -t "$SESSION:editor" "nvim ." Enter

# Window 2: lazygit + shell
tmux new-window -t "$SESSION" -n "terminal" -c "$PROJECT_DIR"
tmux send-keys -t "$SESSION:terminal" "lazygit" Enter
tmux split-window -h -t "$SESSION:terminal" -c "$PROJECT_DIR"

# Window 3: Claude Code
tmux new-window -t "$SESSION" -n "claude" -c "$PROJECT_DIR"
tmux send-keys -t "$SESSION:claude" "claude" Enter

# Focus on editor
tmux select-window -t "$SESSION:editor"

# Attach
exec tmux attach -t "$SESSION"
